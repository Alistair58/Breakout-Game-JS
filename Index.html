<html>
<head>
 <meta charset="utf-8"/>
 <title>Breakout Game</title>
 
 <style>
    .buttonHard {font-family:"Lucida Console";width: 50%;font-size:30px;cursor:pointer;transition-duration: 0.4s;border-radius: 10px;border-color:black;background-color:#e82a43;}
    * {padding: 0;margin:0;}
    .buttonHard:hover{background-color:white;border-color:#e82a43;;}
    .buttonMedium {font-family:"Lucida Console";width: 50%;font-size:30px;cursor:pointer;transition-duration: 0.4s;border-radius: 10px;border-color:black;background-color:#ebb821;;}
    * {padding: 0;margin:0;}
    .buttonMedium:hover{background-color:white;border-color:#ebb821;;}
    .buttonEasy {font-family:"Lucida Console";width: 50%;font-size:30px;cursor:pointer;transition-duration: 0.4s;border-radius: 10px;border-color:black;background-color:#1cd60f;}
    * {padding: 0;margin:0;}
    .buttonEasy:hover{background-color:white;border-color:#1cd60f;}
    .buttonPause {width:5%;font-size:50px;background-color:#e82a43;;cursor:pointer;border-radius:3px}
    .inputBox {background-color:black;color:white;border-radius: 5px;}
    .submitButton {background-color:black;color:white;border-radius: 5px;}
    canvas { background: black; display: block; margin: 0 auto; }
 </style>
</head>
<body style="background-color: grey;">
<button class = "button buttonPause" id="pauseButton" onclick="paused = true;">||</button> 
<audio id="explosion">
    <source src="explosionSound.mp3" type="audio/mp3">
</audio>
<audio id="bounce">
    <source src="bounce.mp3" type="audio/mp3">
</audio>
<audio id="levelUp">
    <source src="levelUp.mp3" type="audio/mp3">
</audio>
<br>
<center><h2 style="font-family:Lucida Console" id="startText">Choose your difficulty to begin</h2>
<br>
<button class="button buttonEasy" id="Btn1" title = "Large paddle and 3 lives" onclick="lives = 3; paddleWidth=100; difficultyChosen = true; difficulty = 1;  allDone();">Easy</button>
<button class="button buttonMedium" id="Btn2" title = "Normal-sized paddle and 2 lives" onclick="lives = 2; paddleWidth=60; difficultyChosen = true; difficulty = 2; allDone();">Medium</button>
<button class="button buttonHard" id="Btn3" title = "Tiny paddle and only 1 life" onclick="lives = 1; paddleWidth=20; difficultyChosen = true; difficulty = 3; allDone();">Hard</button>
<br>
<form name="theForm" id="theForm">
    <label for="rowsInput">Input the number of rows you would like (maximum 8)</label><br>
    <input class="input inputBox" type="number" id="rowNumber" name="rowNumber" value=3>
    <input class="button submitButton" type="button" onclick = "rowsInputted();" value="Submit">
</form>
<br>
<form name="theForm2" id="theForm2">
    <label for="playerInput">Select the number of players</label><br>
    <input type="radio" id="1player" name="players" value=1>
    <label for="1player">1 Player</label><br>
    <input type="radio" id="2player" name="players" value=2>
    <label for="2player">2 Players</label><br>
    <p> (Left is controlled by arrow keys, right controlled by mouse)</p>
    <input class="button submitButton"  type="button" onclick = "playersInputted();" value="Submit">
</form>
</center>
<br>
<canvas id="myCanvas" width="480" height="320">
</canvas>
</body>

<script>
 var canvas = document.getElementById("myCanvas");
 var ctx = canvas.getContext("2d");
 var ballRadius = 10;
 var paddleHeight = 10;
 var paddleWidth = 60;
 var paddleX = (canvas.width-paddleWidth) / 2;
 var paddleY = (canvas.height-paddleHeight);
 var P1paddleX = (canvas.width-paddleWidth) / 4;
 var P1paddleY = (canvas.height-paddleHeight);
 var P2paddleX = ((canvas.width-paddleWidth) / 4)*3;
 var P2paddleY = (canvas.height-paddleHeight);
 var rightPressed = false;
 var leftPressed = false;
 var brickRowCount = 3;
 var brickColumnCount = 5;
 var brickWidth = 75;
 var brickHeight = 20;
 var brickPadding = 10;
 var brickOffsetTop = 30;
 var brickOffsetLeft = 30;
 var score = 0;
 var lives = 3;
 var paused = false;
 var difficultyChosen = false;
 var rowsChosen = false;
 var playersChosen = false;
 var count = 0;
 var bricks = []; //list of bricks
 var playersSelected = 0;
 var colourList = ["#e82a43","#1cd60f","#ebb821","#ff99ff","#d67f1c","#9121db","#21dbc5" ,"#fa0590"];
 var level = 1;
 var dx = 2.5;
 var dy = -2.5;
 var totalScore = 0;
 var resetCount = 0;
 var showHighscore = false;
 var inCanvas = false;
 var specialCount = 0;
 var abilities = ["speedUp","slowDown","doublePoints","paddleSmaller","paddleBigger","1up"];
 var abilityColours = ["#21ff5c","#ff2521","#eafa11","#a805fa","#39f7fa","#047809"];
 var randomAbility = 0
 var ability = "speedUp";
 var abilityColour = "white";
 var leveldy = -2.5;
 var leveldx = 2.5;
 var doublePoints = false;
 var brickGoneCount = 0;
 var difficulty = "";
 let x = canvas.width/2;
 let y = canvas.height-30;
 
 function reset() {
    resetCount++
    ballRadius = 10;
    paddleHeight = 10;
    paddleWidth = 60;
    paddleX = (canvas.width-paddleWidth) / 2;
    paddleY = (canvas.height-paddleHeight);
    P1paddleX = (canvas.width-paddleWidth) / 4;
    P1paddleY = (canvas.height-paddleHeight);
    P2paddleX = ((canvas.width-paddleWidth) / 4)*3;
    P2paddleY = (canvas.height-paddleHeight);
    rightPressed = false;
    leftPressed = false;
    brickRowCount = 3;
    brickColumnCount = 5;
    brickWidth = 75;
    brickHeight = 20;
    brickPadding = 10;
    brickOffsetTop = 30;
    brickOffsetLeft = 30;
    score = 0;
    lives = 3;
    paused = false;
    difficultyChosen = false;
    rowsChosen = false;
    playersChosen = false;
    count = 0;
    bricks = []; //list of bricks
    playersSelected = 0;
    level = 1;
    dx = 0;
    dy = 0;
    totalScore = 0;
    done = false;
    specialCount = 0;
    leveldy = -2.5;
    leveldx = 2.5;
    brickGoneCount = 0;
    Btn1.style.visibility = "visible";
    Btn2.style.visibility = "visible";
    Btn3.style.visibility = "visible";
    startText.style.visibility = "visible";
    var form = document.getElementById("theForm");
    form.style.visibility = "visible";
    var form2 = document.getElementById("theForm2");
    form2.style.visibility = "visible";
 }
 
 
 function createItem() {
    localStorage.setItem("highscore",totalScore)
 }
 function getValue() {
    return localStorage.getItem("highscore")
 }


 function allDone(){
    if(rowsChosen == true && difficultyChosen == true &&  playersChosen == true) { //If both forms have been submitted
        dx = 2.5;
        dy = -2.5;
        if(resetCount == 0) {
            draw();
        }
    }
 }

 function rowsInputted() {
    var rows = document.getElementById("rowNumber").value;
    if(rows<1) {
        alert("Not enough rows");
        rowsChosen = false;
    }
    else if(rows>8) {
        alert("Too many rows");
        rowsChosen = false;
    }
    else {
        brickRowCount = rows;
        rowsChosen = true;
        var form = document.getElementById("theForm");
        form.style.visibility = "hidden";
        allDone();
    }
 }

 function playersInputted() {
    var question = document.getElementsByName("players");
    for(var i=0;i<question.length;i++) {
        if(question[i].checked == true) { //If the box is tickedd
            playersSelected = question[i].value;
            playersChosen = true;
            var form2 = document.getElementById("theForm2");
            form2.style.visibility = "hidden";
            allDone();
            break;
        }
    }
 }

 document.addEventListener("keydown", keyDownHandler, false);
 document.addEventListener("keyup", keyUpHandler, false);
 document.addEventListener("mousemove", mouseMoveHandler, false);
 document.addEventListener("mousemove", P2mouseMoveHandler, false);
 var Btn1 = document.getElementById("Btn1");
 var Btn2 = document.getElementById("Btn2");
 var Btn3 = document.getElementById("Btn3");
 var explosionAudio = document.getElementById("explosion");
 var bounceAudio = document.getElementById("bounce");
 var levelAudio = document.getElementById("levelUp");
 const startText = document.getElementById("startText");
 Btn1.addEventListener("click", () => {
    Btn1.style.visibility = "hidden";
    Btn2.style.visibility = "hidden";
    Btn3.style.visibility = "hidden";
    startText.style.visibility = "hidden";
 });
 Btn2.addEventListener("click", () => {
    Btn1.style.visibility = "hidden";
    Btn2.style.visibility = "hidden";
    Btn3.style.visibility = "hidden";
    startText.style.visibility = "hidden";
 });
 Btn3.addEventListener("click", () => {
    Btn1.style.visibility = "hidden";
    Btn2.style.visibility = "hidden";
    Btn3.style.visibility = "hidden";
    startText.style.visibility = "hidden";
 });
 
 function keyDownHandler(pressed) {
    if(pressed.key == "Right" || pressed.key == "ArrowRight") {
        rightPressed = true;
    }
    else if(pressed.key == "Left" || pressed.key == "ArrowLeft") {
        leftPressed = true;
    }
 }

 function keyUpHandler(notPressed) {
    if(notPressed.key == "Right" || notPressed.key == "ArrowRight") {
        rightPressed = false;
    }
    else if(notPressed.key == "Left" || notPressed.key == "ArrowLeft") {
        leftPressed = false;
    }
 }

 function mouseMoveHandler(e) {
    var relativeX = e.clientX - canvas.offsetLeft; //Distance from left edge
    if(relativeX >  paddleWidth/2 && relativeX < canvas.width-paddleWidth/2) { //If the mouse is in the canvas
        paddleX = relativeX - paddleWidth/2; //paddle location is set to mouse location
    }
 }

 function P2mouseMoveHandler(e) {
    var P2relativeX = e.clientX - canvas.offsetLeft; //Distance from left edge
    if(P2relativeX >  paddleWidth/2 && P2relativeX < canvas.width-paddleWidth/2 && P2relativeX > canvas.width/2+paddleWidth/2) { //If the mouse is on the right side of the canvas
        P2paddleX = P2relativeX - paddleWidth/2; //paddle location is set to mouse location
    }
 }

 function playExplosion() {
    explosionAudio.play();
 }
 function playBounce() {
    bounceAudio.play();
 }
 function playLevelUp() {
    levelAudio.play();
 }

 function drawHighscore(){
    ctx.font = "16px Lucida Console";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Highscore: "+getValue(), canvas.width/2,20);
 }
 function drawScore() {
    ctx.font = "16px Lucida Console";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Score: "+score, 8, 20);
 }
 function drawLives() {
    ctx.font = "16px Lucida Console";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Lives: "+lives, canvas.width-85, 20);
 }

 function drawLevel() {
    ctx.font = "16px Lucida Console";
    ctx.fillStyle = "#0095DD";
    ctx.fillText("Level: "+level, canvas.width/2-115, 20);
 }


 function drawBall() {
    //white circle with black outline
    ctx.beginPath();
    ctx.arc(x,y,ballRadius,0, Math.PI*2,false); //20 is the radius, 0 is the start angle in radians and Math.PI*2 is the end angle and false means draw anti-clockwise
    ctx.fillStyle = "white";
    ctx.fill();
    ctx.strokeStyle = "black";
    ctx.stroke();
    ctx.closePath();
    x += dx;
    y += dy;
 }

 function drawPaddle() {
    ctx.beginPath();
    ctx.rect(paddleX, paddleY, paddleWidth, paddleHeight);
    ctx.fillStyle = "blue";
    ctx.fill();
    ctx.strokeStyle = "black";
    ctx.stroke();
    ctx.closePath();
    if(rightPressed) {
        paddleX += 5;
        if (paddleX + paddleWidth > canvas.width){
            paddleX = canvas.width - paddleWidth;
        }
    }
    else if(leftPressed) {
        paddleX -= 5;
        if (paddleX < 0){
            paddleX = 0;
        }
    }
 }

 function P1drawPaddle() {
    ctx.beginPath();
    ctx.rect(P1paddleX, P1paddleY, paddleWidth, paddleHeight);
    ctx.fillStyle = "blue";
    ctx.fill();
    ctx.strokeStyle = "black";
    ctx.stroke();
    ctx.closePath();
    if(rightPressed) {
        P1paddleX += 5;
        if (P1paddleX + paddleWidth > canvas.width/2){
            P1paddleX = canvas.width/2 - paddleWidth;
        }
    }
    else if(leftPressed) {
        P1paddleX -= 5;
        if (P1paddleX < 0){
            P1paddleX = 0;
        }
    }
 }

 function P2drawPaddle() {
    ctx.beginPath();
    ctx.rect(P2paddleX, P2paddleY, paddleWidth, paddleHeight);
    ctx.fillStyle = "blue";
    ctx.fill();
    ctx.strokeStyle = "black";
    ctx.stroke();
    ctx.closePath();
 }

 function drawBricks() {
    randomC = Math.floor(Math.random()*brickColumnCount);
    randomR = Math.floor(Math.random()*brickRowCount);
    for(var c=0; c<brickColumnCount; c++) {
        for(var r=0; r<brickRowCount; r++) {
            if(bricks[c][r].status ==1) { //Draw if brick hasn't been hit
                var brickX = (c*(brickWidth+brickPadding)) +brickOffsetLeft; //x coordinate is the column X width (including padding) + the offset 
                var brickY = (r*(brickHeight+brickPadding)) + brickOffsetTop;
                bricks[c][r].x = brickX;
                bricks[c][r].y = brickY;
                if(c==randomC && r==randomR && specialCount == 0) {
                    bricks[c][r].special = true;
                    randomAbility = Math.floor(Math.random()*Object.keys(abilities).length);
                    ability = abilities[randomAbility];
                    abilityColour = abilityColours[randomAbility];
                    specialCount++;
                }
                ctx.beginPath();
                ctx.rect(brickX, brickY, brickWidth, brickHeight);
                if(bricks[c][r].special == true) {
                    ctx.fillStyle = abilityColour;
                }
                else {
                    ctx.fillStyle = colourList[r];
                }
                ctx.fill();
                ctx.closePath();
                
            }

        }
    }  
 }

 function collisionDetection() {
    for(var c=0; c<brickColumnCount; c++){
        for(var r=0; r<brickRowCount; r++){ //Iterates through every brick in the array
            var brick = bricks[c][r]; //Stores each brick as brick
            if(brick.status == 1){
                if(x > brick.x && x < brick.x+brickWidth && y > brick.y && y < brick.y+brickHeight) { //If the ball is between the x and y values of the brick
                    playExplosion();
                    brickGoneCount ++;
                    if(bricks[c][r].special==true){
                        if(ability=="speedUp"){
                            if(dy > 0 && dx > 0) {
                                dy += 1;
                                dx += 1;
                            }
                            else if(dy < 0 && dx < 0) {
                                dy -= 1;
                                dx -= 1;
                            }
                            else if(dy < 0 && dx > 0) {
                                dy -= 1;
                                dx += 1;
                            }
                            else{
                                dy +=1;
                                dx -=1;
                            }
                        }
                        else if(ability=="slowDown"){
                            if(dy < 0 && dx < 0) {
                                dy += 1;
                                dx += 1;
                            }
                            else if(dy > 0 && dx > 0) {
                                dy -= 1;
                                dx -= 1;
                            }
                            else if(dy > 0 && dx < 0) {
                                dy -= 1;
                                dx += 1;
                            }
                            else{
                                dy +=1;
                                dx -=1;
                            }
                        }
                        else if(ability=="doublePoints"){
                            doublePoints = true;
                        }
                        else if(ability=="paddleSmaller"){
                            if(difficulty == 1){
                                paddleWidth = 60;
                            }
                            else if(difficulty==2){
                                paddleWidth = 20;
                            }
                            
                            else if(difficulty == 3){
                             paddleWidth = 10;
                            }
                        }
                        else if(ability=="paddleBigger"){
                            if(difficulty == 1){
                                paddleWidth = 150;
                            }
                            else if(difficulty==2){
                                paddleWidth = 100;
                            }
                            
                            else if(difficulty == 3){
                             paddleWidth = 60;
                            }
                        }
                        else if(ability=="1up"){
                            lives ++;
                        }
                    }
                    brick.status = 0;  //brick is now destroyed
                    dy = -dy; //Changes direction
                    if(doublePoints == true){
                        score++;
                        score++;
                        totalScore++;
                        totalScore++;
                    }
                    else{
                        score++;
                        totalScore++;
                    }
                    if(brickGoneCount == brickRowCount*brickColumnCount){
                        brickGoneCount = 0;
                        alert("CONGRATULATIONS, level passed");
                        playLevelUp();
                        level ++;
                        specialCount = 0;
                        dy = leveldy;
                        dx = leveldx;
                        if(dy > 0 && dx > 0) {
                                dy += 0.5;
                                dx += 0.5;
                                leveldy += 0.5;
                                leveldx += 0.5;
                            }
                            else if(dy < 0 && dx < 0) {
                                dy -= 0.5;
                                dx -= 0.5;
                                leveldy -= 0.5;
                                leveldx -= 0.5;
                            }
                            else if(dy < 0 && dx > 0) {
                                dy -= 0.5;
                                dx += 0.5;
                                leveldy -= 0.5;
                                leveldx += 0.5;
                            }
                            else{
                                dy +=0.5;
                                dx -=0.5;
                                leveldy += 0.5;
                                leveldx -= 0.5;
                            }
                        if(difficulty == 1){
                                paddleWidth = 100;
                        }
                        else if(difficulty==2){
                                paddleWidth = 60;
                        }
                        else if(difficulty == 3){
                             paddleWidth = 20;
                        }
                        score = 0;
                        count = 0;
                        doublePoints = false;
                        inCanvas = false;
                        while(inCanvas == false) {
                            x = Math.floor(Math.random()*(canvas.width-ballRadius))+ballRadius;
                            if(x > 480 || x < 10) {
                            }
                            else {
                                inCanvas = true;
                            }
                        }
                        y = canvas.height-30;
                        
                    }
                }
            }
        }
    }
 }
 

 function bounce() {
    if(x + dx > canvas.width-ballRadius  || x + dx < ballRadius) { //If ball bounces off sides
        dx = -dx;
        playBounce();
    }
        
    if(y + dy < ballRadius) { //If ball bounces off the top
        dy = -dy;
        playBounce();            
    }
    if(playersSelected==1) {
        if(x+ballRadius > paddleX && x-ballRadius < paddleX + paddleWidth && y + dy > (canvas.height-paddleHeight)-ballRadius+5) { // If the x and y coordinates of the ball is between each end of the paddle it bounces. 5 just seems to make it bounce in the right place
        dy = -dy;
        playBounce();
        }
        else if(y + dy > canvas.height-ballRadius) { //If ball hits the bottom
            lives--;
            if(lives==0) {
                alert("GAME OVER");
                if(resetCount ==0){
                    createItem();
                    showHighscore = true;
                    drawHighscore();
                }
                else{
                    if(totalScore>getValue()){
                        createItem()
                    }
                }
                reset();
            }
            else { //If there are lives left, the ball and paddle are reset
                inCanvas = false;
                while(inCanvas == false) {
                    x = Math.floor(Math.random()*(canvas.width-ballRadius))+ballRadius;
                    if(x > 480 || x < 10) {
                    }
                    else {
                        inCanvas = true;
                    }
                }
                y = canvas.height-30;
                if(dy > 0) {
                    dy = -dy;      
                }
                else if(dx , 0) {
                    dx = -dx;      
                }
                paddleX = (canvas.width-paddleWidth)/2;
            }
        }
    }
    else {
        if((x+ballRadius > P1paddleX && x-ballRadius < P1paddleX + paddleWidth && y + dy > (canvas.height-paddleHeight)-ballRadius+5)  || (x+ballRadius > P2paddleX && x-ballRadius < P2paddleX + paddleWidth && y + dy > (canvas.height-paddleHeight)-ballRadius+5)) { // If the x and y coordinates of the ball is between each end of either paddle it bounces. 5 just seems to make it bounce in the right place
            playBounce();
            dy = -dy;
        }
        else if(y + dy > canvas.height-ballRadius) { //If ball hits the bottom
            lives--;
            if(lives==0) {
                alert("GAME OVER");
                if(resetCount ==0){
                    createItem();
                    showHighscore = true;
                    drawHighscore();
                }
                else{
                    if(totalScore>getValue()){
                        createItem()
                    }
                }
                reset();
                
            }
            else { //If there are lives left, the ball and paddle are reset
                inCanvas = false;
                while(inCanvas == false) {
                    x = Math.floor(Math.random()*(canvas.width-ballRadius))+ballRadius;
                    if(x > 480 || x < 10) {
                    }
                    else {
                        inCanvas = true;
                    }
                }
                y = canvas.height-30;
                if(dy > 0) {
                    dy = -dy;      
                }
                else if(dx , 0) {
                    dx = -dx;      
                }
                paddleX = (canvas.width-paddleWidth)/2;
            }
    
        }
    }
 }

 function draw() {
    //clears screen so it doesn't leave a trail
    count ++
    if (count == 1) { //If it's the first loop create the brick list
        for(var c=0; c<brickColumnCount; c++) { //c is like an iteration variable in python. It increments by 1 on each loop. Loop ends when c >= column count.
            bricks[c] = []; // Creates a 2d array. Each column has its own list
            for(var r=0; r<brickRowCount; r++) {
                bricks[c][r] = { x: 0, y:0, status:1 ,special:false}; //status 1 means the brick hasn't been destroyed
            }
        } 
    }
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBricks();
    drawBall();
    if(playersSelected==1) {
        drawPaddle();
    }
    else if(playersSelected==2){
        P1drawPaddle();
        P2drawPaddle();
    }
    drawScore();
    drawLives();
    drawLevel();
    if(showHighscore==true){
        drawHighscore();
    }
    collisionDetection();
    bounce();
    if (paused == true){
        alert("Paused\nPress OK to resume");
        paused = false;
    }
    requestAnimationFrame(draw);
  
    
 }
</script>

</body>
</html>